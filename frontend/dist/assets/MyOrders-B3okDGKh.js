import{c as w,h as k,r as m,j as e,B as P,P as i,z as y,o as C,m as D,A as L,q as A}from"./index-rlvyAQjv.js";import{P as O}from"./paymentService-_WYo1tQy.js";import{f as _}from"./formatters-MA0lDvmk.js";import{C as $}from"./credit-card-CpIeBnpi.js";import{T as F}from"./triangle-alert-BbW4PYWa.js";import{T as U}from"./truck-DlIyHYNf.js";import{R as V}from"./refresh-ccw-S8xwMgCL.js";import{C as W,a as Q}from"./chevron-left-ClVCkRiE.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],G=w("box",Z);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],J=w("calendar",H);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],X=w("chevron-down",K);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ee=w("chevron-up",Y);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],se=w("clock",te),E={checkout:async a=>(await k.post("/orders",a)).data,getMyOrders:async(a=1,d=10)=>(await k.get(`/orders?page=${a}&pageSize=${d}`)).data,requestRefund:async(a,d)=>(await k.post(`/orders/${a}/request-refund`,d)).data};function T({order:a,onClose:d,onSubmit:f,isLoading:j}){const[o,R]=m.useState("Total"),[c,v]=m.useState({}),g=(s,u)=>{v(r=>{const n={...r};return n[s]?delete n[s]:n[s]=u,n})},S=(s,u,r)=>{const n=Math.max(1,Math.min(parseInt(u)||1,r));v(N=>({...N,[s]:n}))},b=()=>{const s={refundType:o,items:o==="Parcial"?Object.entries(c).map(([u,r])=>({productId:u,quantity:r})):[]};f(s)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Solicitar Reembolso"}),e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"type",checked:o==="Total",onChange:()=>R("Total")}),e.jsx("span",{children:"Reembolso Total (Pedido Inteiro)"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"type",checked:o==="Parcial",onChange:()=>R("Parcial")}),e.jsx("span",{children:"Reembolso Parcial (Selecionar Itens)"})]})]}),o==="Parcial"&&e.jsx("div",{className:"mb-4 max-h-60 overflow-y-auto border p-2 rounded",children:a.items.map((s,u)=>{const r=s.productId||u,n=!!c[r];return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>g(r,s.quantity)}),e.jsx("span",{className:"text-sm",children:s.productName})]}),n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",className:"w-16 p-1 border rounded text-right",value:c[r],onChange:N=>S(r,N.target.value,s.quantity),min:"1",max:s.quantity}),e.jsxs("span",{className:"text-xs text-gray-500",children:["/ ",s.quantity]})]})]},r)})}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded mb-4 text-right",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Valor Estimado do Estorno:"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:o==="Total"?_(a.totalAmount):"R$ A calcular pelo admin"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* O valor final será analisado e confirmado pelo administrador."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"outline",onClick:d,disabled:j,children:"Cancelar"}),e.jsx(P,{onClick:b,isLoading:j,disabled:o==="Parcial"&&Object.keys(c).length===0,children:"Confirmar Solicitação"})]})]})})}T.propTypes={order:i.shape({totalAmount:i.number.isRequired,items:i.arrayOf(i.shape({productId:i.string,productName:i.string,quantity:i.number,unitPrice:i.number})).isRequired}).isRequired,onClose:i.func.isRequired,onSubmit:i.func.isRequired,isLoading:i.bool};const me=()=>{const[a,d]=m.useState([]),[f,j]=m.useState(!0),[o,R]=m.useState(null),[c,v]=m.useState(1),[g,S]=m.useState(1),[b,s]=m.useState(null),[u,r]=m.useState(!1);m.useEffect(()=>{n()},[c]);const n=async()=>{try{j(!0);const t=await E.getMyOrders(c);d(t.items||[]),S(t.totalPages||1)}catch{y.error("Não foi possível carregar seus pedidos.")}finally{j(!1)}},N=t=>R(o===t?null:t),q=async(t,l)=>{t.stopPropagation();const h=y.loading("Iniciando pagamento...");try{const{url:p}=await O.createCheckoutSession(l);window.location.href=p}catch{y.error("Erro ao iniciar pagamento.",{id:h})}},I=t=>{s(t)},z=async t=>{var h,p;if(!b)return;const l=y.loading("Enviando solicitação...");r(!0);try{await E.requestRefund(b.id,t),y.success("Solicitação enviada com sucesso!",{id:l}),await n(),s(null)}catch(x){y.error(((p=(h=x.response)==null?void 0:h.data)==null?void 0:p.message)||"Erro ao solicitar reembolso.",{id:l})}finally{r(!1)}},B=t=>{const l=t.status;if(!["Pago","Enviado","Entregue"].includes(l))return{showSection:!1,canRefund:!1,label:""};if(l==="Pago"||l==="Enviado")return{showSection:!0,canRefund:!0,label:"Solicitar Cancelamento"};if(l==="Entregue"){if(!t.deliveryDate)return{showSection:!0,canRefund:!1,label:"Aguardando data..."};const p=new Date(new Date(t.deliveryDate).setDate(new Date(t.deliveryDate).getDate()+7)),x=new Date<=p;return{showSection:!0,canRefund:x,label:x?"Solicitar Devolução":"Prazo Expirado"}}return{showSection:!1,canRefund:!1,label:""}};return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-8 flex items-center gap-3",children:[e.jsx(C,{className:"text-primary"})," Meus Pedidos"]}),a.length===0?e.jsxs("div",{className:"bg-white p-12 rounded-xl shadow-sm border border-gray-100 text-center",children:[e.jsx(C,{size:48,className:"mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-700",children:"Nenhum pedido encontrado"})]}):e.jsxs("div",{className:"space-y-6",children:[a.map(t=>{const{showSection:l,canRefund:h,label:p}=B(t);return e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all hover:shadow-md",children:[e.jsxs("div",{onClick:()=>N(t.id),className:"p-6 cursor-pointer flex flex-col md:flex-row md:items-center justify-between gap-4 bg-gray-50/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-bold text-lg text-gray-800",children:["Pedido #",t.id.slice(0,8).toUpperCase()]}),e.jsx(ae,{status:t.status})]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(J,{size:14})," ",new Date(t.orderDate).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Total"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.totalAmount)})]}),t.status==="Pendente"&&e.jsxs(P,{size:"sm",onClick:x=>q(x,t.id),children:[e.jsx($,{size:16})," Pagar"]}),o===t.id?e.jsx(ee,{className:"text-gray-400"}):e.jsx(X,{className:"text-gray-400"})]})]}),e.jsxs(L,{children:[t.status==="Reembolso Reprovado"&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 mx-6 mt-4",children:[e.jsxs("h4",{className:"text-red-800 font-bold flex items-center gap-2 mb-2",children:[e.jsx(F,{size:18})," Solicitação de Reembolso Negada"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-red-700 uppercase block mb-1",children:"Motivo da Análise:"}),e.jsx("p",{className:"text-sm text-gray-800 bg-white p-3 rounded border border-red-100",children:t.refundRejectionReason||"Entre em contato com o suporte para mais detalhes."})]}),t.refundRejectionProof&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-red-700 uppercase block mb-1",children:"Evidência Anexada:"}),e.jsx("div",{className:"mt-2",children:t.refundRejectionProof.endsWith(".mp4")||t.refundRejectionProof.endsWith(".webm")?e.jsxs("video",{controls:!0,className:"w-full max-w-sm rounded border border-gray-300 max-h-64",children:[e.jsx("source",{src:t.refundRejectionProof,type:"video/mp4"}),"Seu navegador não suporta vídeos."]}):e.jsx("a",{href:t.refundRejectionProof,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:t.refundRejectionProof,alt:"Prova",className:"h-32 w-auto object-cover rounded border border-gray-300 hover:opacity-90 transition-opacity"})})})]})]})]}),o===t.id&&e.jsx(D.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden border-t border-gray-100",children:e.jsxs("div",{className:"p-6 bg-white",children:[t.reverseLogisticsCode&&e.jsxs("div",{className:"mb-6 bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-orange-800 font-bold flex items-center gap-2 mb-2",children:[e.jsx(G,{size:18})," Instruções de Devolução"]}),e.jsx("p",{className:"text-sm text-orange-900 mb-3",children:t.returnInstructions||"Leve o produto até uma agência dos Correios."}),e.jsxs("div",{className:"bg-white border border-orange-200 p-3 rounded flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Código de Postagem"}),e.jsx("span",{className:"font-mono text-lg font-bold text-gray-800 tracking-wider",children:t.reverseLogisticsCode})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-2 text-gray-600 bg-primary/5 p-3 rounded-lg border border-primary/10 flex-1",children:[e.jsx(A,{size:18,className:"mt-0.5 text-primary"}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-primary text-sm",children:"Endereço"}),e.jsx("span",{className:"text-sm",children:t.shippingAddress})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[t.trackingCode&&e.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded border border-gray-200 flex items-center gap-2",children:[e.jsx(U,{size:16,className:"text-primary"})," Rastreio: ",e.jsx("span",{className:"font-mono font-bold",children:t.trackingCode})]}),t.deliveryDate&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx(se,{size:14})," Entregue: ",new Date(t.deliveryDate).toLocaleDateString("pt-BR")]})]})]}),e.jsx("table",{className:"w-full text-left text-sm mb-4",children:e.jsx("tbody",{className:"divide-y border-b border-gray-100",children:t.items.map((x,M)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"py-2 font-medium text-gray-800",children:[x.quantity,"x ",x.productName]}),e.jsx("td",{className:"py-2 text-right font-bold text-gray-800",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x.total)})]},M))})}),e.jsxs("div",{className:"flex flex-col items-end gap-1 text-sm text-gray-700 mb-6",children:[e.jsxs("div",{className:"flex justify-between w-full max-w-[240px]",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.subTotal||0)})]}),t.discount>0&&e.jsxs("div",{className:"flex justify-between w-full max-w-[240px] text-green-600",children:[e.jsx("span",{children:"Desconto:"}),e.jsxs("span",{children:["- ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.discount)]})]}),e.jsxs("div",{className:"flex justify-between w-full max-w-[240px] text-primary",children:[e.jsx("span",{children:"Frete:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.shippingCost||0)})]}),e.jsxs("div",{className:"flex justify-between w-full max-w-[240px] font-bold text-lg mt-2 border-t pt-2 border-gray-200",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.totalAmount)})]})]}),l&&e.jsx("div",{className:"border-t pt-3 flex justify-end",children:e.jsxs("button",{disabled:!h,onClick:()=>I(t),className:`text-xs font-medium px-3 py-1.5 rounded transition-colors flex items-center gap-1.5
                                            ${h?"text-red-600 hover:bg-red-50 border border-red-200":"text-gray-400 bg-gray-50 border border-gray-200 cursor-not-allowed opacity-70"}`,children:[e.jsx(V,{size:12})," ",p]})})]})})]})]},t.id)}),g>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8 pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>v(t=>Math.max(1,t-1)),disabled:c===1,className:"p-2 rounded-lg border bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(W,{size:20})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Página ",c," de ",g]}),e.jsx("button",{onClick:()=>v(t=>Math.min(g,t+1)),disabled:c===g,className:"p-2 rounded-lg border bg-white text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Q,{size:20})})]})]}),b&&e.jsx(T,{order:b,onClose:()=>s(null),onSubmit:z,isLoading:u})]})},ae=({status:a})=>{const d={Pendente:"bg-yellow-100 text-yellow-800",Pago:"bg-green-100 text-green-800",Enviado:"bg-blue-100 text-blue-800",Entregue:"bg-gray-100 text-gray-800",Cancelado:"bg-red-100 text-red-800","Reembolso Solicitado":"bg-purple-100 text-purple-800","Aguardando Devolução":"bg-orange-100 text-orange-800",Reembolsado:"bg-gray-800 text-white","Reembolso Reprovado":"bg-red-200 text-red-900","Parcialmente Reembolsado":"bg-purple-200 text-purple-900"};return e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${d[a]||"bg-gray-100"}`,children:a})};export{me as MyOrders};
